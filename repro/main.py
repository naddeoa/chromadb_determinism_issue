from sentence_transformers import SentenceTransformer
from pprint import pprint
import chromadb
from chromadb.api.types import IncludeEnum

encoder = SentenceTransformer(
    "all-MiniLM-L6-v2", revision="8b3219a92973c328a8e22fadcfa821b5dc75636a"
)
embedding = encoder.encode("What is your name?", convert_to_numpy=True)
print(f"Embedding: {embedding[:20].tolist()}")  # type: ignore
client = chromadb.PersistentClient("./chromadb")
collection = client.get_collection("collection")

distances = []
for _ in range(10):
    results = collection.query(
        n_results=3,
        query_embeddings=embedding.tolist(),  # type: ignore
        include=[IncludeEnum.metadatas, IncludeEnum.distances, IncludeEnum.embeddings],
    )
    distances.append(results["distances"])

# This will give different results each time it runs, seemingly randomly. For example, here are two different runs:
# [[[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]],
#  [[0.7512401342391968, 0.7793669104576111, 0.8091723322868347]]]
#
# [[[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]],
#  [[0.7512401342391968, 0.8091723322868347, 0.8145251274108887]]]
pprint(distances)
